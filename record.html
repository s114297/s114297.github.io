<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>ç´€éŒ„é </title>

<style>
body{
  margin:0;
  font-family: "Noto Sans TC", sans-serif;
  background:#bfae9c;
}

.container{
  display:grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto auto;
  gap:20px;
  padding:30px;
}

.box{
  background:#f5f0ea;
  border-radius:20px;
  padding:20px;
}

h2{
  margin-top:0;
  text-align:center;
}

/* è®“ä¸­é–“å€åŸŸæ©«è·¨ */
.center{
  grid-column:1 / 3;
}
button{
  padding:8px 16px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}
input, textarea{
  width:100%;
  margin-bottom:10px;
  padding:6px;
}
</style>
</head>

<body>

<div class="container">

<!-- æ’è¡Œæ¦œ -->
<div class="box">
  <h2>ğŸ† æ’è¡Œæ¦œï¼ˆå‰ååï¼‰</h2>
  <ol id="rankList"></ol>
</div>

<!-- æˆ¿é–“ -->
<div class="box">
  <h2>ğŸ‘¥ å’Œæœ‹å‹ä¸€èµ·ç©</h2>
  <button onclick="createRoom()">å‰µå»ºæˆ¿é–“</button>
  <p id="roomCode"></p>

  <input id="joinInput" placeholder="è¼¸å…¥æˆ¿é–“ä»£ç¢¼">
  <button onclick="joinRoom()">åŠ å…¥æˆ¿é–“</button>
</div>

<!-- æ–°å¢ç´€éŒ„ -->
<div class="box center">
  <h2>ğŸ“ å€‹äººç´€éŒ„å€</h2>

  <label>æ™‚é–“ï¼ˆåªèƒ½é¸ç¾åœ¨ä»¥å‰ï¼‰</label>
  <input type="datetime-local" id="time">

  <label>å¦‚å»ç‹€æ³ï¼ˆä¸é †æš¢ â†’ é †æš¢ï¼‰</label>
  <input type="range" min="1" max="5" id="feel">

  <label>å‚™è¨»ï¼ˆéå¿…å¡«ï¼‰</label>
  <textarea id="note"></textarea>

  <button onclick="addRecord()">æ–°å¢è³‡æ–™</button>
  <button onclick="clearRecord()">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>

  <ul id="recordList"></ul>
</div>

</div>

<script>
// åˆå§‹åŒ–
let records = JSON.parse(localStorage.getItem("records")) || [];
let scores = JSON.parse(localStorage.getItem("scores")) || {};

// é™åˆ¶æ™‚é–“ä¸èƒ½é¸æœªä¾†
document.getElementById("time").max = new Date().toISOString().slice(0,16);

// æ–°å¢ç´€éŒ„
function addRecord(){
  const time = document.getElementById("time").value;
  const feel = document.getElementById("feel").value;
  const note = document.getElementById("note").value;
  const name = localStorage.getItem("nickname") || "åŒ¿å";

  if(!time){
    alert("è«‹é¸æ“‡æ™‚é–“");
    return;
  }

  records.push({time, feel, note});
  localStorage.setItem("records", JSON.stringify(records));

  scores[name] = (scores[name] || 0) + 1;
  localStorage.setItem("scores", JSON.stringify(scores));

  // æ¸…ç©ºæ¬„ä½
  document.getElementById("time").value = "";
  document.getElementById("feel").value = 3;
  document.getElementById("note").value = "";

  render();
}

// æ¸…é™¤ç´€éŒ„
function clearRecord(){
  if(confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿ")){
    records = [];
    localStorage.removeItem("records");
    render();
  }
}

// æˆ¿é–“
function createRoom(){
  const code = Math.random().toString(36).substring(2,8).toUpperCase();
  document.getElementById("roomCode").innerText = "æˆ¿é–“ä»£ç¢¼ï¼š" + code;
}

function joinRoom(){
  const code = document.getElementById("joinInput").value;
  alert("å·²åŠ å…¥æˆ¿é–“ï¼š" + code);
}

// é¡¯ç¤ºç•«é¢
function render(){
  const list = document.getElementById("recordList");
  list.innerHTML = "";
  records.forEach(r=>{
    const li = document.createElement("li");
    li.innerText = `æ™‚é–“:${r.time}ï½œç‹€æ³:${r.feel}ï½œå‚™è¨»:${r.note || "ç„¡"}`;
    list.appendChild(li);
  });

  const rank = document.getElementById("rankList");
  rank.innerHTML = "";
  Object.entries(scores)
    .sort((a,b)=>b[1]-a[1])
    .slice(0,10)
    .forEach(([name,score])=>{
      const li = document.createElement("li");
      li.innerText = `${name}ï¼š${score} æ¬¡`;
      rank.appendChild(li);
    });
}

render();
</script>

</body>
</html>
