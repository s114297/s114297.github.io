<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>ç´€éŒ„é </title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>ç´€éŒ„é </h1>
<p>ä½ å¥½ï¼Œ<span id="userName"></span> ğŸ‘‹</p>

<div class="main-grid">

  <!-- ğŸ† æ’è¡Œæ¦œ -->
  <div class="section">
    <h2>ğŸ† æ’è¡Œæ¦œï¼ˆå‰ 10 åï¼‰</h2>
    <ol id="rankList"></ol>
  </div>

  <!-- ğŸ“ å€‹äººç´€éŒ„ -->
  <div class="section">
    <h2>å€‹äººç´€éŒ„å€</h2>

    <label>æ™‚é–“</label>
    <input type="datetime-local" id="time">

    <label>å¦‚å»ç‹€æ³ï¼ˆå·¦ä¸èˆ’æœ â†’ å³èˆ’æœï¼‰</label>
    <input type="range" min="1" max="5" id="feel">

    <label>å‚™è¨»ï¼ˆéå¿…å¡«ï¼‰</label>
    <input id="note">

    <button onclick="addRecord()">æ–°å¢è³‡æ–™</button>
<button onclick="clearRecords()">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>

    <h3>æˆ‘çš„ç´€éŒ„</h3>
    <ul id="recordList"></ul>
  </div>

  <!-- ğŸ‘¥ æˆ¿é–“ -->
  <div class="section">
    <h2>å’Œæœ‹å‹ä¸€èµ·ç©</h2>

    <button onclick="createRoom()">å‰µå»ºæˆ¿é–“</button>
    <p id="roomText">å°šæœªåŠ å…¥æˆ¿é–“</p>

    <input id="roomInput" placeholder="è¼¸å…¥æˆ¿é–“ä»£ç¢¼">
    <button onclick="joinRoom()">åŠ å…¥æˆ¿é–“</button>
  </div>

  <!-- â“ å¸¸è¦‹å•é¡Œ -->
  <div class="section">
    <h2>å¸¸è¦‹å•é¡Œ</h2>

    <p><strong>ä¾¿ç§˜å°èº«é«”çš„å±å®³</strong></p>

    <p>1.çŸ­æœŸå½±éŸ¿</p>
    <p>ãƒ»è…¹è„¹ã€ä¸èˆ’æœ</p>
    <p>ãƒ»æ’ä¾¿ç”¨åŠ›ï¼Œè¦ºå¾—ç—›æˆ–ç–²ç´¯</p>
    <p>ãƒ»é£Ÿæ…¾è®Šå·®ã€æ³¨æ„åŠ›ä¸‹é™</p>

    <p>2.é•·æœŸå½±éŸ¿</p>
    <p>ãƒ»è…¸é“åŠŸèƒ½è®Šå·®</p>
    <p>ãƒ»è®“äººç…©èºæˆ–ç„¦æ…®</p>
    <p>ãƒ»é¤Šæˆæ†‹ä¾¿å£ç¿’æ…£</p>
  </div>

</div>

<script>
/* ========= ä½¿ç”¨è€… ========= */
let nickname = localStorage.getItem("nickname") || "è¨ªå®¢";
document.getElementById("userName").innerText = nickname;

/* ========= å€‹äººç´€éŒ„ ========= */
let records = JSON.parse(localStorage.getItem("records")) || [];

/* ========= æ’è¡Œæ¦œï¼ˆä»¥ç´€éŒ„æ•¸é‡è¨ˆç®—ï¼Œæœ€ç©©ï¼‰ ========= */
let scores = {};

/* ========= æˆ¿é–“ ========= */
let savedRoom = localStorage.getItem("roomCode");
if (savedRoom) {
  document.getElementById("roomText").innerText =
    "ç›®å‰æ‰€åœ¨æˆ¿é–“ï¼š" + savedRoom;
}

/* ========= åˆå§‹åŒ–ç•«é¢ ========= */
records.forEach(showRecord);
recalculateScores();
updateRank();

/* ========= æ–°å¢ç´€éŒ„ ========= */
function addRecord() {
  let time = document.getElementById("time").value;
  let feel = document.getElementById("feel").value;
  let note = document.getElementById("note").value || "ç„¡";

  if (time === "") {
    alert("è«‹é¸æ“‡æ™‚é–“");
    return;
  }

  let record = { time, feel, note };
  records.push(record);

  localStorage.setItem("records", JSON.stringify(records));
  showRecord(record);

  recalculateScores();
  updateRank();

  alert("å·²æ–°å¢ç´€éŒ„ï¼");
}

/* ========= é¡¯ç¤ºå–®ç­†ç´€éŒ„ ========= */
function showRecord(record) {
  let li = document.createElement("li");
  li.innerText =
    "æ™‚é–“ï¼š" + record.time +
    "ï½œç‹€æ³ï¼š" + record.feel +
    "ï½œå‚™è¨»ï¼š" + record.note;
  document.getElementById("recordList").appendChild(li);
}

/* ========= é‡æ–°è¨ˆç®—æ’è¡Œæ¦œ ========= */
function recalculateScores() {
  scores = {};
  records.forEach(function () {
    if (!scores[nickname]) {
      scores[nickname] = 0;
    }
    scores[nickname]++;
  });
}

/* ========= æ›´æ–°æ’è¡Œæ¦œ ========= */
function updateRank() {
  let list = document.getElementById("rankList");
  list.innerHTML = "";

  let arr = [];
  for (let name in scores) {
    arr.push({ name, score: scores[name] });
  }

  arr.sort(function (a, b) {
    return b.score - a.score;
  });

  arr.slice(0, 10).forEach(function (item) {
    let li = document.createElement("li");
    li.innerText = item.name + "ï¼š" + item.score + " æ¬¡";
    list.appendChild(li);
  });
}

/* ========= æˆ¿é–“åŠŸèƒ½ ========= */
function makeRoomCode() {
  return Math.random().toString(36).substring(2, 8).toUpperCase();
}

function createRoom() {
  let code = makeRoomCode();
  localStorage.setItem("roomCode", code);
  document.getElementById("roomText").innerText =
    "ä½ çš„æˆ¿é–“ä»£ç¢¼æ˜¯ï¼š" + code;
  alert("æˆ¿é–“å·²å»ºç«‹ï¼");
}

function joinRoom() {
  let code = document.getElementById("roomInput").value;
  if (code === "") {
    alert("è«‹è¼¸å…¥æˆ¿é–“ä»£ç¢¼");
    return;
  }
  localStorage.setItem("roomCode", code);
  document.getElementById("roomText").innerText =
    "ä½ å·²åŠ å…¥æˆ¿é–“ï¼š" + code;
  alert("æˆåŠŸåŠ å…¥æˆ¿é–“ï¼");
}
function clearRecords() {

  // å†ç¢ºèªä¸€æ¬¡ï¼Œé¿å…èª¤æŒ‰
  if (!confirm("ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç´€éŒ„å—ï¼Ÿé€™å€‹å‹•ä½œç„¡æ³•å¾©åŸ")) {
    return;
  }

  // æ¸…é™¤ç´€éŒ„è³‡æ–™
  records = [];
  localStorage.removeItem("records");

  // æ¸…é™¤æ’è¡Œæ¦œè³‡æ–™
  localStorage.removeItem("scores");

  // æ¸…ç©ºç•«é¢ä¸Šçš„æ¸…å–®
  document.getElementById("recordList").innerHTML = "";
  document.getElementById("rankList").innerHTML = "";

  alert("æ‰€æœ‰ç´€éŒ„å·²æ¸…é™¤ï¼");
}


</body>
</html>
